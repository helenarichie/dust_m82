import matplotlib.pyplot as plt
import numpy as np
import os
import pathlib
import sys
sys.path.insert(0, os.path.join(pathlib.Path(__file__).parent.resolve(), "../../utils/"))
from read_cmdline import read_cmdline

def main(outdir):
    menard_distances = np.array([0.3748124373033481, 2.095583961111869, 11.722165859375771, 66.50119930808623, 372.04527293566287, 2113.5388407544983, 11790.943227587353, 66972.95686414257, 373881.6941106425, 2088037.573200979, 11868221.632906396, 66219741.345317066])
    menard_densities = np.array([0.005101952250289417, 0.0024367977457989813, 0.001019990175175307, 0.0009423495649296874, 0.0003791373424660041, 0.00024207734900064627, 0.00020937118228565133,  0.0001390805744007113, 0.00010000000000000021, 0.00006469761215918919, 0.00003572799097214369, 0.000029701567487517446])

    richie_distances = np.linspace(0, 10, 80)
    richie_densities = np.array([2556.92441628, 2558.46884943, 2554.22565062, 2586.90489379, 2591.83108087, 2564.32200778, 2563.5890196, 2595.53721238, 2578.15528981, 2572.28326492, 2577.32697637, 2570.33335503, 2588.1789505, 2585.41392458, 2590.95009244, 2570.2015437, 
                                 2559.97369423, 2572.15376939, 2554.35428518, 2591.21436789, 2576.41297926, 2542.25664425, 2571.58850217, 2550.72122702, 2564.45165504, 2578.59180232, 2555.25276238, 2545.18488652, 2562.55492643, 2543.9108942, 2584.53768961, 2550.38017012, 
                                 2581.69286471, 2577.2838824, 2543.06240305, 2540.73142169, 2586.55385775, 2562.12405472, 2561.21974046, 2569.68167024, 2525.24537841, 2565.0554326, 2557.01034811, 2564.3648219, 2538.19288795, 2563.28860829, 2569.85514339, 2556.28130592, 
                                 2550.54992466, 2567.99315987, 2559.15654632, 2578.0246424, 2547.31126708, 2551.23310587, 2570.93803522, 2555.21197332, 2552.21586087, 2570.15796507, 2529.30831231, 2551.10504501, 2537.5169387, 2549.3138363, 2566.04837996, 2570.76667423, 
                                 2566.73943947, 2562.68407779, 2550.25212832, 2540.60436287, 2577.80763123, 2569.37850438, 2578.72265081, 2580.6867285, 2601.60612483, 2541.53573773, 2571.54574409, 2551.0626541, 2592.1841814, 2562.03805468, 2556.10941873, 2567.301615])

    richie_densities *= (1e-3) ** 2  # convert from M_sun / kpc^2 to M_sun / pc^2

    av_distance = np.average(distances)
    av_density = np.average(densities)

    slope = np.sum((distances - av_distance) * (densities - av_density)) / np.sum((distances - av_distance)**2)
    intercept = av_density - slope * av_distance

    plt.loglog(distances, densities, marker="D", color="red")
    plt.xlabel("r [kpc]")
    plt.ylabel(r"$\Sigma_\mathrm{dust}$ $[h\,M_\odot/pc^2]$")

    plt.savefig(os.path.join(outdir, "menard.png"), dpi=300)

if __name__ == "__main__":
    args = read_cmdline()

    sys.path.insert(0, args.configdir)
    import hconfig

    outdir = args.outdir

    main(outdir)