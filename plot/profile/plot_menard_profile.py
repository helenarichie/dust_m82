import matplotlib.pyplot as plt
import numpy as np
import os
import pathlib
import sys
sys.path.insert(0, os.path.join(pathlib.Path(__file__).parent.resolve(), "../../utils/"))
from read_cmdline import read_cmdline

def main(outdir):
    menard_distances = np.array([0.3748124373033481, 2.095583961111869, 11.722165859375771, 66.50119930808623, 372.04527293566287, 2113.5388407544983, 11790.943227587353, 66972.95686414257, 373881.6941106425, 2088037.573200979, 11868221.632906396, 66219741.345317066])
    menard_densities = np.array([0.005101952250289417, 0.0024367977457989813, 0.001019990175175307, 0.0009423495649296874, 0.0003791373424660041, 0.00024207734900064627, 0.00020937118228565133,  0.0001390805744007113, 0.00010000000000000021, 0.00006469761215918919, 0.00003572799097214369, 0.000029701567487517446])

    richie_distances = np.linspace(0, 10, 80)
    richie_m82_densities = np.array([16414101.11219476, 2157366.1771358526, 350060.19212868536, 111440.05311740877, 59161.900039055974, 41520.75143672225, 29721.630140612797, 23763.7949065255, 19013.748036974757, 15415.173584435242, 12559.427874529112, 10575.505391522865, 9029.280211779092, 8359.232265656154, 7303.599660932744, 6631.795679219331, 5674.693891398707, 5006.000208348573, 4309.740341376569, 3999.1790105408622, 3655.8310931803767, 3409.4367385641785, 3344.291671280468, 2872.6720360956633, 2637.362053664231, 2483.146713481518, 2161.8942602564866, 1867.8617232415074, 1623.2690875620979, 1463.8378219253545, 1299.7282105241761, 1126.2650805178887, 1008.7240152624878, 972.4398822861184, 939.1002857848697, 853.2572484779632, 780.2218501039974, 693.731569444573, 673.1550321910427, 639.8945134237954, 559.7931835542211, 513.7272772961686, 489.39635392972434, 470.52189137987216, 441.1437248422035, 403.52687768389694, 396.0158587927553, 386.61225273947423, 376.5051847427643, 362.5220567841531, 344.64529240224977, 319.81310597648155, 301.105543261142, 271.98733782541274, 249.2443992388979, 241.59061935234394, 234.37427468816128, 231.07250339227448, 211.125389396103, 190.54075379100877, 174.58402671382382, 173.96794871833856, 164.47803327478218, 154.75569592723483, 139.58304900143256, 130.600539326685, 122.57758616278352, 116.56138836253265, 110.86625733071835, 106.01660632438761, 99.50951873326254, 94.30575892925705, 88.21477409158253, 82.27666941660773, 77.910360542401, 74.91620740826296, 71.06758955096512, 66.8373288214874, 63.5995948112751, 58.666552140601475])
    richie_highz_densities = np.array([6552382.674037674, 2064346.6800506953, 868700.593851146, 543925.2502222401, 395856.3473567337, 285687.2431040703, 221060.07318542735, 161399.00366030866, 123315.12309640174, 93921.81004114705, 73600.59468128257, 60775.53222584643, 54656.541634962414, 44832.4583554218, 38195.89416910453, 33610.26335337982, 31191.578071936136, 28128.47325665749, 24972.534553710706, 22635.233533773495, 19557.313044036164, 17608.365209811152, 15952.52104907203, 14729.491526975555, 12756.829998977644, 10794.943768979889, 10063.29047607386, 9181.832786281755, 8388.165269991054, 7547.877507134172, 6894.340133247999, 6975.070883474501, 6309.004032107861, 5655.097707937111, 5123.3392245083805, 4727.94496465636, 4270.335096943136, 4203.144539595825, 4011.4788311391644, 3819.8421815871284, 3450.6844121615277, 3215.2235720644007, 3096.663036522234, 2944.6299278084957, 2782.44499718754, 2765.0553390436044, 2692.8378444549253, 2446.4646283316956, 2273.068662668756, 2111.1817375300548, 1853.5779373097782, 1790.0573189813185, 1749.6692641764344, 1624.145856619263, 1392.3339013146879, 1303.137659194655, 1241.5166079802086, 1158.9608099468326, 1051.2693243966896, 965.4013961093435, 910.5743887340923, 831.7343188950001, 772.1922556880138, 717.9534879400114, 681.2182524971184, 646.8797940605758, 612.0918609738707, 588.0235982841275, 549.6801380052708, 493.2908257302453, 452.18348623255264, 426.2272172652717, 401.0302834864437, 370.8258211778773, 349.6843759440167, 329.5928876367568, 309.68400656127284, 294.3489820390987, 290.757766399365, 195.33668927421328])

    richie_m82_densities *= (1e-3) ** 2  # convert from M_sun / kpc^2 to M_sun / pc^2
    richie_highz_densities *= (1e-3) **2

    plt.loglog(menard_distances, menard_densities, marker="D", color="red", label="Menard et al. (2010)")
    plt.plot(richie_distances, richie_m82_densities, color="black", label="m82, Richie & Schneider (2025)")
    plt.plot(richie_distances, richie_highz_densities, color="blue", label="high-z, Richie & Schneider (2025)")
    plt.xlabel("r [kpc]")
    plt.ylabel(r"$\Sigma_\mathrm{dust}$ $[h\,M_\odot/pc^2]$")
    plt.legend()

    plt.savefig(os.path.join(outdir, "menard.png"), dpi=300)

if __name__ == "__main__":
    args = read_cmdline()

    sys.path.insert(0, args.configdir)
    import hconfig

    outdir = args.outdir

    main(outdir)